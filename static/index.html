<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>PowerPoint Name Inserter</title>
<style>
body { font-family: Arial; max-width: 700px; margin: 40px auto; }
.box { border: 2px dashed #888; padding: 30px; text-align: center; border-radius: 10px; }
.row { margin-top: 15px; display: flex; gap: 10px; }
input[type=text] { flex: 1; padding: 10px; }
button { padding: 10px 15px; cursor: pointer; }
progress { width: 100%; margin-top: 15px; }
#msg { margin-top: 15px; color: #b00; }
#info { margin-bottom: 15px; color: #333; }
</style>
</head>
<body>

<h2>PowerPoint Watermark Web App</h2>

<div id="info">
⚠️ If this app has not been used recently, the server may take up to <b>60 seconds</b> to wake up before processing.
</div>

<div class="box">
<input type="file" id="file" accept=".pptx"/>
</div>

<div class="row">
<input id="name" type="text" placeholder="Enter name (e.g., TEST)">
<button onclick="run()">Process</button>
</div>

<progress id="prog" value="0" max="100" style="display:none;"></progress>
<div id="msg"></div>

<script>
function run() {
  const f = document.getElementById('file').files[0];
  const name = document.getElementById('name').value.trim();
  const msg = document.getElementById('msg');
  const prog = document.getElementById('prog');

  if (!f) return msg.textContent = "Upload a .pptx file.";
  if (!name) return msg.textContent = "Enter a name.";

  msg.style.color = "#000";
  msg.textContent = "Processing... If server was idle, it may take up to 60 seconds.";
  prog.style.display = "block";
  prog.value = 10;

  const form = new FormData();
  form.append("file", f);
  form.append("name", name);

  fetch("/process", {
    method: "POST",
    body: form
  })
  .then(async response => {
    if (!response.ok) throw new Error("Server error.");
    prog.value = 70;
    const blob = await response.blob();
    prog.value = 100;

    const url = window.URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = f.name.replace(".pptx","") + "__named.pptx";
    document.body.appendChild(a);
    a.click();
    a.remove();
    window.URL.revokeObjectURL(url);

    msg.textContent = "Done.";
    prog.style.display = "none";
  })
  .catch(err => {
    msg.style.color = "#b00";
    msg.textContent = "Error: " + err.message;
    prog.style.display = "none";
  });
}
</script>

</body>
</html>
