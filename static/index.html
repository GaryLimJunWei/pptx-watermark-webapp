<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>PPTX → PDF Name Inserter</title>
<style>
body { font-family: Arial; max-width: 700px; margin: 40px auto; }
.box { border: 2px dashed #888; padding: 30px; text-align: center; border-radius: 10px; }
.row { margin-top: 15px; display: flex; gap: 10px; }
input[type=text] { flex: 1; padding: 10px; }
button { padding: 10px 15px; cursor: pointer; }
progress { width: 100%; margin-top: 15px; }
#msg { margin-top: 15px; color: #b00; }
#info { margin-bottom: 15px; color: #333; }
</style>
</head>
<body>

<h2>PowerPoint watermark web app</h2>

<div id="info">
If this app has not been used recently, the server may take up to <b>60 seconds</b> to wake up before processing.
<br><br>
Output format: <b>PDF</b>.
</div>

<div class="box">
  <input type="file" id="file" accept=".pptx"/>
</div>

<div class="row">
  <input id="name" type="text" placeholder="Enter name (will be red text)">
  <button onclick="run()">Convert</button>
</div>

<progress id="prog" value="0" max="100" style="display:none;"></progress>
<div id="msg"></div>

<script>
function run() {
  const f = document.getElementById('file').files[0];
  const name = document.getElementById('name').value.trim();
  const msg = document.getElementById('msg');
  const prog = document.getElementById('prog');

  if (!f) return msg.textContent = "Upload a .pptx file.";
  if (!name) return msg.textContent = "Enter a name.";

  msg.style.color = "#000";
  msg.textContent = "Processing… If server was idle, it may take up to 60 seconds.";
  prog.style.display = "block";
  prog.value = 10;

  const form = new FormData();
  form.append("file", f);
  form.append("name", name);

  fetch("/process", { method: "POST", body: form })
    .then(async (response) => {
      if (!response.ok) {
        const text = await response.text().catch(()=> "");
        throw new Error("Server error. " + text);
      }
      prog.value = 70;

      const blob = await response.blob();
      prog.value = 100;

      const url = URL.createObjectURL(blob);

      let filename = "output.pdf";
      const cd = response.headers.get("Content-Disposition") || "";
      const m = cd.match(/filename="([^"]+)"/i);
      if (m && m[1]) filename = m[1];

      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);

      msg.textContent = "Done.";
      prog.style.display = "none";
    })
    .catch(err => {
      msg.style.color = "#b00";
      msg.textContent = "Error: " + err.message;
      prog.style.display = "none";
    });
}
</script>

</body>
</html>
